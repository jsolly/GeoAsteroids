var it=Object.defineProperty;var rt=(t,e,o)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var c=(t,e,o)=>(rt(t,typeof e!="symbol"?e+"":e,o),o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const d=60,C=0,H=240,Z=0,$=3,B=5,h=30,lt=.3,J=3,I=.1,U=300,st=10,at=.6,ct=.1,z=20,V=50,g=50,G=10,X=.5,dt=20,ut=50,ht=100,Q=0,_="highscore",O="musicOn",A="soundOn",R=40,ft=2.5,a=document.querySelector("canvas"),n=a.getContext("2d");class S{constructor(e,o){this.x=e,this.y=o}}function N(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}let tt,P;function et(t,e){tt=t,P=e}function gt(){return P}function mt(){n.fillStyle="black",n.fillRect(0,0,a.width,a.height)}function St(){n.textAlign="center",n.textBaseline="middle",n.fillStyle="rgba(255,255,255, "+String(P)+")",n.font="small-caps "+String(R)+"px dejavu sans mono",n.fillText(tt,a.width/2,a.height*3/4),P-=1/ft/d}function Mt(t,e,o="white"){const l=h/2,i=t.x,s=t.y;n.strokeStyle=o,n.lineWidth=h/20,n.beginPath(),n.moveTo(i+4/3*l*Math.cos(e),s-4/3*l*Math.sin(e)),n.lineTo(i-l*(2/3*Math.cos(e)+Math.sin(e)),s+l*(2/3*Math.sin(e)-Math.cos(e))),n.lineTo(i-l*(2/3*Math.cos(e)-Math.sin(e)),s+l*(2/3*Math.sin(e)+Math.cos(e))),n.closePath(),n.stroke()}let w=Q,b=Z;function wt(){w=Q,b=Z}function p(){return b}function xt(t){w+=t}function yt(t){let e;for(let o=0;o<t.lives;o++){e=vt(t,o);const l=new S(h+o*h*1.2,h);Mt(l,.5*Math.PI,e)}}function vt(t,e){return t.exploding&&e==t.lives-1?"red":"white"}function Tt(){n.textAlign="right",n.textBaseline="middle",n.fillStyle="white",n.font=String(R)+"px dejavu sans mono",n.fillText(String(w),a.width-15,30),n.textAlign="center",n.textBaseline="middle",n.fillStyle="white",n.font=String(R*.75)+"px dejavu sans mono",n.fillText("BEST "+String(Pt()),a.width/2,30)}let j,K;function It(){j="Level "+String(b+1),K=1,b++,et(j,K)}function Pt(){const t=localStorage.getItem(_);if(t==null)return localStorage.setItem(_,"0"),0;let e=Number(t);return w>e&&(e=w,localStorage.setItem(_,String(e))),e}class M{constructor(e,o){c(this,"a");c(this,"offsets",[]);c(this,"vertices");c(this,"xv");c(this,"yv");this.centroid=e,this.r=o;const l=p(),i=1+.1*l;this.a=Math.random()*Math.PI*2,this.xv=Math.random()*V*i/d*(Math.random()<.5?1:-1),this.yv=Math.random()*V*i/d*(Math.random()<.5?1:-1),this.vertices=Math.floor(Math.random()*(G+1)+G/2);for(let s=0;s<this.vertices;s++)this.offsets.push(Math.random()*X*2+1-X)}}class bt{constructor(e){c(this,"roids",[]);c(this,"currentLevel",p());for(let o=0;o<z+this.currentLevel;o++){let l;do{const i=Math.floor(Math.random()*a.width),s=Math.floor(Math.random()*a.height);l=new S(i,s)}while(N(e.centroid,l)<g*2+e.r);this.roids.push(new M(l,Math.ceil(g/2)))}}}function W(t,e){const o=e[t].r;let l=0;o==Math.ceil(g/2)?(e.push(new M(e[t].centroid,Math.ceil(g/4))),e.push(new M(e[t].centroid,Math.ceil(g/4))),l+=dt):o==Math.ceil(g/4)?(e.push(new M(e[t].centroid,Math.ceil(g/8))),e.push(new M(e[t].centroid,Math.ceil(g/8))),l+=ut):l+=ht,xt(l),e.splice(t,1)}function Et(t,e){for(const o of e){n.strokeStyle="slategrey",n.lineWidth=1.5;const l=a.width/2-t.centroid.x+o.centroid.x,i=a.height/2-t.centroid.y+o.centroid.y,s=o.r,f=o.a,k=o.vertices,x=o.offsets;n.beginPath(),n.moveTo(l+s*x[0]*Math.cos(f),i+s*x[0]*Math.sin(f));for(let m=1;m<k;m++)n.lineTo(l+s*x[m]*Math.cos(f+m*Math.PI*2/k),i+s*x[m]*Math.sin(f+m*Math.PI*2/k));n.closePath(),n.stroke()}}function Lt(t){for(const e of t)e.centroid=new S(e.centroid.x+e.xv,e.centroid.y+e.yv)}const kt=document.getElementById("toggle-music"),_t=document.getElementById("toggle-sound");_t.addEventListener("click",pt);kt.addEventListener("click",Ct);class L{constructor(e,o=1,l=.05){c(this,"streamNum",0);c(this,"streams",[]);for(let i=0;i<o;i++)this.streams.push(new Audio(e)),this.streams[i].volume=l}play(){v&&(this.streamNum=(this.streamNum+1)%this.streams.length,this.streams[this.streamNum].play())}stop(){this.streams[this.streamNum].pause(),this.streams[this.streamNum].currentTime=0}}class Ot{constructor(e,o){c(this,"srcLow");c(this,"soundLow");c(this,"srcHigh");c(this,"soundHigh");c(this,"low",!0);c(this,"tempo",1);c(this,"beatTime",0);this.srcLow=e,this.soundLow=new Audio(e),this.srcHigh=o,this.soundHigh=new Audio(o)}play(){this.low?this.soundLow.play():this.soundHigh.play(),this.low=!this.low}setAsteroidRatio(e){const o=p(),l=(z+o)*7,i=e.length==0?1:e.length/l;this.tempo=1-.75*(1-i)}tick(){this.beatTime==0?(this.play(),this.beatTime=Math.ceil(this.tempo*d)):this.beatTime--}}const Y=new L("sounds/thrust.m4a"),nt=5,At=new L("sounds/laser.m4a",nt),F=new L("sounds/hit.m4a",nt),Rt=new L("sounds/explode.m4a"),y=new Ot("sounds/music-low.m4a","sounds/music-high.m4a");let v=Nt(),T=Dt();function Nt(){const t=localStorage.getItem(O);return t==null?(localStorage.setItem(O,"false"),!1):t==="true"}function Dt(){const t=localStorage.getItem(A);return t==null?(localStorage.setItem(A,"false"),!1):t==="true"}function pt(){v=!v,localStorage.setItem(O,String(v)),document.getElementById("toggle-sound").blur()}function Ct(){T=!T,localStorage.setItem(A,String(T)),document.getElementById("toggle-music").blur()}function Ht(){return T}class ot{constructor(e=$,o=!1){c(this,"centroid",new S(a.width,a.height));c(this,"t",0);c(this,"xv",0);c(this,"yv",0);c(this,"r",h/2);c(this,"a",90/180*Math.PI);c(this,"blinkCount",Math.ceil(J/I));c(this,"blinkTime",Math.ceil(I*d));c(this,"canShoot",!0);c(this,"dead",!1);c(this,"exploding",!1);c(this,"lasers",[]);c(this,"explodeTime",0);c(this,"rot",0);c(this,"thrusting",!1);this.lives=e,this.blinkOn=o}}function Bt(t=$,e=!1){return new ot(t,e)}function Ut(t){t.dead=!0}function Vt(t){t.blinkOn=t.blinkCount%2==0}function Gt(t){t.exploding=t.explodeTime>0}function Xt(t){t.explodeTime=Math.ceil(lt*d),t.blinkCount=Math.ceil(J/I),Rt.play()}function jt(t){t.thrusting&&!t.dead?(t.xv-=B*Math.cos(t.a)/d,t.yv-=B*Math.sin(t.a)/d,Y.play(),Wt(t)):(t.xv-=C*t.xv/d,t.yv-=C*t.yv/d,Y.stop())}function Kt(t){t.a+=t.rot,t.centroid.x+=t.xv,t.centroid.y+=t.yv}function Wt(t){!t.exploding&&t.blinkOn&&(n.fillStyle="red",n.strokeStyle="yellow",n.lineWidth=h/10,n.beginPath(),n.moveTo(a.width/2+t.r*(2/3*Math.cos(t.a)+.5*Math.sin(t.a)),a.height/2+t.r*(2/3*Math.sin(t.a)-.5*Math.cos(t.a))),n.lineTo(a.width/2+t.r*5/3*Math.cos(t.a),a.height/2+t.r*5/3*Math.sin(t.a)),n.lineTo(a.width/2+t.r*(2/3*Math.cos(t.a)-.5*Math.sin(t.a)),a.height/2+t.r*(2/3*Math.sin(t.a)+.5*Math.cos(t.a))),n.closePath(),n.fill(),n.stroke())}function Yt(t){const e=t.a;n.strokeStyle="white",n.lineWidth=h/20,n.beginPath(),n.moveTo(a.width/2+4/3*t.r*Math.cos(e+1.06),a.height/2+4/3*t.r*Math.sin(e+1.06)),n.lineTo(a.width/2+t.r*(-1/3*Math.cos(e+1.06)+Math.sin(e+1.06)),a.height/2+t.r*(-1/3*Math.sin(e+1.06)-Math.cos(e+1.06))),n.lineTo(a.width/2+t.r*(-1/3*Math.cos(e+1.06)-Math.sin(e+1.06)),a.height/2+t.r*(-1/3*Math.sin(e+1.06)+Math.cos(e+1.06))),n.closePath(),n.stroke()}function Ft(t){const e=t.centroid.x,o=t.centroid.y;n.fillStyle="darkred",n.beginPath(),n.arc(e,o,t.r*1.7,0,Math.PI*2,!1),n.fill(),n.fillStyle="red",n.beginPath(),n.arc(e,o,t.r*1.4,0,Math.PI*2,!1),n.fill(),n.fillStyle="Orange",n.beginPath(),n.arc(e,o,t.r*1.1,0,Math.PI*2,!1),n.fill(),n.fillStyle="Yellow",n.beginPath(),n.arc(e,o,t.r*.8,0,Math.PI*2,!1),n.fill(),n.fillStyle="White",n.beginPath(),n.arc(e,o,t.r*.5,0,Math.PI*2,!1),n.fill()}class qt{constructor(e,o,l,i,s){this.centroid=e,this.xv=o,this.yv=l,this.distTraveled=i,this.explodeTime=s}}function Zt(t){function e(o){return!!(o.canShoot&&o.lasers.length<st)}if(e){const o=-U*Math.cos(-t.a)/d+t.xv,l=U*Math.sin(-t.a)/d+t.yv,i=new S(t.centroid.x,t.centroid.y),s=new qt(i,o,l,0,0);t.lasers.push(s),At.play()}t.canShoot=!1}function $t(t){for(const e of t.lasers){const o=e.centroid.y,l=e.centroid.x,i=t.centroid.x,s=t.centroid.y;e.explodeTime==0?(n.fillStyle="salmon",n.beginPath(),n.arc(l-i+a.width/2,o-s+a.height/2,h/15,0,Math.PI*2,!1),n.fill()):(n.fillStyle="orangered",n.beginPath(),n.arc(l-i+a.width/2,o-s+a.height/2,t.r*.75,0,Math.PI*2,!1),n.fill(),n.fillStyle="salmon",n.beginPath(),n.arc(l-(i-a.width),o-(s-a.height),t.r*.5,0,Math.PI*2,!1),n.fill(),n.fillStyle="pink",n.beginPath(),n.arc(l-(i-a.width),o-(s-a.height),t.r*.25,0,Math.PI*2,!1),n.fill())}}function Jt(t){for(let e=t.lasers.length-1;e>=0;e--){const o=t.lasers[e];if(o.distTraveled>at*a.width){t.lasers.splice(e,1);continue}if(o.explodeTime>0){if(o.explodeTime--,o.explodeTime==0){t.lasers.splice(e,1);continue}}else o.centroid=new S(o.centroid.x+o.xv,o.centroid.y+o.yv),o.distTraveled+=.5}}function zt(t,e){if(!t.dead)switch(e.code){case"Space":Zt(t);break;case"ArrowLeft":t.rot=-H/180*Math.PI/d;break;case"ArrowUp":t.thrusting=!0;break;case"ArrowRight":t.rot=H/180*Math.PI/d;break}}function Qt(t,e){if(!t.dead)switch(e.code){case"Space":t.canShoot=!0;break;case"ArrowLeft":t.rot=0;break;case"ArrowUp":t.thrusting=!1;break;case"ArrowRight":t.rot=0;break}}let r,u;document.addEventListener("keydown",t=>zt(r,t));document.addEventListener("keyup",t=>Qt(r,t));function q(){wt(),r=new ot,D()}function D(){It(),u=new bt(r).roids}function te(){Ut(r),et("Game Over",1),y.tempo=1,E()}setInterval(E,1e3/d);function E(){r||q(),Vt(r),Gt(r),mt(),Et(r,u),Tt(),yt(r),gt()>=0?St():r.dead&&q(),Ht()&&y.tick(),r.exploding?Ft(r):(r.blinkOn&&!r.dead&&Yt(r),r.blinkCount>0&&(r.blinkTime--,r.blinkTime==0&&(r.blinkTime=Math.ceil(I*d),r.blinkCount--))),$t(r);for(let e=r.lasers.length-1;e>=0;e--)for(let o=u.length-1;o>=0;o--)t(r.lasers[e],u[o])&&(W(o,u),F.play(),u.length==0&&D(),r.lasers[e].explodeTime=Math.ceil(ct*d),y.setAsteroidRatio(u));function t(e,o){return e.explodeTime==0&&N(o.centroid,e.centroid)<o.r}if(r.exploding)r.explodeTime--,r.explodeTime==0&&(r.lives--,r.lives==0?te():(Bt(r.lives,r.blinkOn),E()));else if(r.blinkCount==0&&!r.dead)for(let e=0;e<u.length;e++)N(r.centroid,u[e].centroid)<r.r+u[e].r&&(Xt(r),W(e,u),F.play(),u.length==0&&D(),y.setAsteroidRatio(u),E());jt(r),r.exploding||Kt(r),Jt(r),Lt(u)}
